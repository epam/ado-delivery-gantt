import{__assign,__extends}from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Dropdown.css";import*as React from"react";import{ObservableLike}from"../../Core/Observable";import{format}from"../../Core/Util/String";import{Button}from"../../Button";import{Callout,ContentSize}from"../../Callout";import{FocusZone,FocusZoneDirection,FocusZoneKeyStroke}from"../../FocusZone";import{IconSize}from"../../Icon";import{ListBox}from"../../ListBox";import{Observer}from"../../Observer";import*as Resources from"../../Resources.Dropdown";import{TextField}from"../../TextField";import{css,getSafeIdSelector,KeyCode,preventDefault}from"../../Util";var ItemsForFilter=10,DefaultWidth=256,FilterBarPadding=16,FilterBarIconWidth=27;function DropdownCallout(e){return React.createElement(DropdownCalloutComponent,__assign({},e))}var DropdownCalloutComponent=function(o){function e(e){var t=o.call(this,e)||this;return t.callout=React.createRef(),t.calloutContent=React.createRef(),t.filterBox=React.createRef(),t.initFocusElement=React.createRef(),t.updateLayout=function(){return setTimeout(function(){t.callout.current&&t.callout.current.updateLayout()},0),!0},t.onMouseDown=function(e){t.props.ignoreMouseDown&&"INPUT"!==e.target.tagName&&preventDefault(e)},t.listBoxDidUpdate=function(){t.getScrollWidth()},t.getScrollWidth=function(){window.requestAnimationFrame(function(){var e;t.calloutContent.current&&0<=t.props.width&&(e=t.calloutContent.current.offsetWidth-t.props.width,1<Math.abs(e))&&t.setState({scrollBarWidth:e+t.state.scrollBarWidth})})},t.state={scrollBarWidth:0},t}return __extends(e,o),e.prototype.componentDidMount=function(){this.getScrollWidth()},e.prototype.focus=function(){this.filterBox.current?this.filterBox.current.focus():this.initFocusElement.current&&this.initFocusElement.current.focus()},e.prototype.render=function(){function t(){o.props.onDismiss&&o.props.onDismiss(),P()}var o=this,e=this.props,r=e.actions,n=e.anchorElement,l=e.anchorOffset,i=e.anchorOrigin,a=e.anchorPoint,s=e.ariaLabel,c=e.blurDismiss,u=e.calloutContentClassName,d=e.columns,m=e.containerClassName,f=e.contentLocation,p=e.dropdownOrigin,h=e.enforceSingleSelect,b=e.excludeFocusZone,w=e.excludeTabStop,g=e.filteredItems,v=e.filteredNoResultsText,x=e.filteredResultsLoadingText,R=e.filterPlaceholderText,C=e.filterText,F=e.focusOnMount,k=e.getUnselectableRanges,D=e.id,S=e.items,Z=e.lightDismiss,_=e.listBoxClassName,M=e.listBoxRef,z=e.loading,K=e.onActivate,U=e.onFilterKeyDown,I=e.onFilterTextChanged,A=e.onSelect,V=e.onToggle,B=e.renderBeforeContent,q=e.renderItem,E=e.searching,j=e.selection,N=e.showCloseButton,T=e.showFilterBox,G=e.showItemsWhileSearching,H=e.showTree,y=e.title,L=e.updateFilteredItems,e=e.userFilteredItems,O=this.props.width,O=void 0===O?DefaultWidth:O,W=(0<O&&(O-=this.state.scrollBarWidth),"bolt-dropdown-textfield-"+D),P=function(){C.value="",I&&I(null,""),L&&L()};return React.createElement(Callout,{anchorElement:n,anchorOffset:l,anchorOrigin:i,anchorPoint:a,role:"presentation",blurDismiss:void 0===c||c,calloutOrigin:p,contentClassName:css(u,"bolt-dropdown flex-column custom-scrollbar v-scroll-auto h-scroll-hidden"),contentLocation:f,contentRef:this.calloutContent,contentShadow:!0,contentSize:ContentSize.Auto,escDismiss:!0,id:D,lightDismiss:Z,focuszoneProps:{postprocessKeyStroke:function(e){return e.which!==KeyCode.tab||e.defaultPrevented?FocusZoneKeyStroke.IgnoreNone:(e.preventDefault(),t(),FocusZoneKeyStroke.IgnoreAll)}},onDismiss:t,ref:this.callout},React.createElement(FocusZone,{circularNavigation:!0,defaultActiveElement:T||void 0===T&&S.length>ItemsForFilter?getSafeIdSelector(W):".bolt-dropdown-init-focus",direction:FocusZoneDirection.Vertical,focusOnMount:void 0===F||F,preventScrollOnFocus:window.self!==window.top},React.createElement("div",{className:"bolt-dropdown-container no-outline",onMouseDown:this.onMouseDown,onKeyDown:U,style:{width:0<=O?O:void 0}},React.createElement("div",{"aria-hidden":"true","aria-roledescription":Resources.DropdownCalloutRoleDescription,className:"bolt-dropdown-init-focus no-outline",tabIndex:w?void 0:-1,ref:this.initFocusElement,role:"menuitem"}),React.createElement(Observer,{items:{observableValue:S,filter:this.updateLayout}},function(){var e=void 0===T?S.length>ItemsForFilter:T;return e||y||N?React.createElement("div",{className:"bolt-dropdown-header-container"},(y||N)&&React.createElement("div",{className:"bolt-dropdown-header flex-row flex-center"},React.createElement("div",{className:"bolt-dropdown-header-text flex-grow font-weight-semibold"},y),N&&React.createElement(Button,{className:"bolt-dropdown-header-button",ariaLabel:Resources.Close,iconProps:{iconName:"Cancel"},onClick:t,subtle:!0})),e&&React.createElement("div",{key:"bolt-dropdown-filter-container",className:"bolt-dropdown-filter-container"},React.createElement(Observer,{filterText:C},function(e){return React.createElement(TextField,{key:"bolt-dropdown-filter",ariaLabel:Resources.SearchAriaLabel,className:"bolt-dropdown-filter",excludeTabStop:!0,inputId:W,onChange:I,placeholder:R,prefixIconProps:{iconName:"Search"},ref:o.filterBox,value:C,maxWidth:o.props.width-FilterBarPadding-FilterBarIconWidth,suffixIconProps:0<e.filterText.length?{ariaLabel:Resources.ClearText,iconName:"ChromeClose",onClick:P,size:IconSize.small,tooltipProps:{text:Resources.ClearText},role:"button"}:void 0})}))):null}),B&&B(),React.createElement(Observer,{filteredItems:g,filteredNoResultsText:v,listBoxItems:{observableValue:S,filter:L},userFilteredItems:{observableValue:e,filter:L}},function(e){var t=null;return(g&&0===g.length||0===S.length)&&!E&&(e=""===C.value?o.props.noItemsText:format(e.filteredNoResultsText||Resources.NoFilterResults,C.value))&&(t=React.createElement("div",{className:"bolt-dropdown-no-items"},e)),React.createElement(React.Fragment,null,t,React.createElement(ListBox,{ariaLabel:s,className:_,columns:d,containerClassName:css("bolt-dropdown-list-box-container",m),didUpdate:o.listBoxDidUpdate,enforceSingleSelect:h,excludeFocusZone:b,excludeTabStop:!0,searchResultsLoadingText:x,focuszoneProps:null,getUnselectableRanges:k,items:g?g.value:S,loading:z,onActivate:K,onSelect:A,onToggle:V,renderItem:q,ref:M,searching:E,selection:j,showChecksColumn:!0,showItemsWhileSearching:G,showTree:H}))}),React.createElement(Observer,{actions:r},function(e){var t=o.props.actions;return t&&t.length?React.createElement("div",{className:"bolt-actions-container flex-column"},ObservableLike.getValue(t).map(function(e,t){return React.createElement(Button,__assign({key:e.id||t,subtle:!0,excludeTabStop:!0},e))})):null}))))},e.defaultProps={width:DefaultWidth,ignoreMouseDown:!0},e}(React.Component);export{DropdownCallout,DropdownCalloutComponent};