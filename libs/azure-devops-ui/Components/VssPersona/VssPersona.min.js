import{__assign,__extends}from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./VssPersona.css";import*as React from"react";import{Icon}from"../../Icon";import{Tooltip}from"../../TooltipEx";import{css,KeyCode}from"../../Util";import{getColorString}from"../../Utilities/Color";import{getInitialsColorFromName,getInitialsFromName}from"./VssPersona.Initials";var VssPersona=function(r){function e(e){var t=r.call(this,e)||this;return t.setTargetElement=function(e){t.targetElement=e},t.onImageError=function(e){t.props.showInitialsOnImageError?t.setState({imageError:!0}):t.props.onImageError&&t.props.onImageError(e)},t.handleKeyDown=function(e){e.keyCode!==KeyCode.enter&&e.keyCode!==KeyCode.space||t.showPersonaCard()},t.showPersonaCard=function(){t.props.suppressPersonaCard||t.setState({showPersonaCard:!0})},t.hidePersonaCard=function(){t.setState({showPersonaCard:!1})},t.state={imageError:!1,showPersonaCard:!1,imageUrlVal:t._getImageUrl(e)},t}return __extends(e,r),e.prototype.UNSAFE_componentWillReceiveProps=function(e){this.setState({showPersonaCard:!1,imageUrlVal:this._getImageUrl(e)})},e.prototype.shouldComponentUpdate=function(e,t){return!(e.identityDetailsProvider||this.props.imageUrl===e.imageUrl&&this.props.displayName===e.displayName)||!(!this.props.identityDetailsProvider&&!e.identityDetailsProvider||this.props.identityDetailsProvider&&e.identityDetailsProvider&&this.props.size===e.size&&this.props.cssClass===e.cssClass&&this.props.identityDetailsProvider===e.identityDetailsProvider&&this.state.showPersonaCard===t.showPersonaCard)},e.prototype.render=function(){var e=this.props,t=e.ariaLabel,r=e.identityDetailsProvider,s=e.size,s=void 0===s?"medium":s,a=e.imgAltText,a=void 0===a?"":a,o=e.imageUrl,e=e.displayName,o=r?this.state.imageUrlVal:o,i={role:"img"},e=(this.props.dataIsFocusable&&(i["data-is-focusable"]=!0),this.props.isTabStop&&(i.tabIndex=0),!this.props.suppressPersonaCard&&this.props.identityDetailsProvider&&this.props.identityDetailsProvider.onRenderPersonaCard&&(i["aria-expanded"]=this.state.showPersonaCard,i.onKeyDown=this.handleKeyDown,i.onClick=this.showPersonaCard,i.role="button"),r?r.getDisplayName():e),t=(t?i["aria-label"]=t:e?i["aria-label"]=e:i["aria-hidden"]="true",void 0===e?void 0:getInitialsColorFromName(e)),t=void 0===o||this.state.imageError?React.createElement("div",{className:css("vss-Persona-content",s),style:t&&{background:getColorString(t)}},e?React.createElement("span",null,getInitialsFromName(e)):React.createElement(Icon,{iconName:"Contact"})):React.createElement("img",{className:"vss-Persona-content using-image",src:o,alt:a,onError:this.onImageError});return React.createElement(React.Fragment,null,React.createElement(Tooltip,{text:e,showOnFocus:!0},React.createElement("div",__assign({className:css("vss-Persona flex-noshrink",this.props.className,this.props.cssClass,s),ref:this.setTargetElement},i),t)),!this.props.suppressPersonaCard&&this.state.showPersonaCard&&r&&r.onRenderPersonaCard&&r.onRenderPersonaCard(this.targetElement,this.hidePersonaCard))},e.prototype._getImageUrl=function(e){var t=e.identityDetailsProvider,e=e.size,e=this._getSize(void 0===e?"medium":e);return t&&t.getIdentityImageUrl(e)},e.prototype._getSize=function(e){switch(e){case"extra-extra-small":return 16;case"extra-small":return 18;case"extra-small-plus":return 20;case"small":return 24;case"small-plus":return 28;case"medium":return 32;case"medium-plus":return 40;default:case"large":return 48;case"extra-large":return 72;case"extra-extra-large":return 100}},e}(React.Component);export{VssPersona};