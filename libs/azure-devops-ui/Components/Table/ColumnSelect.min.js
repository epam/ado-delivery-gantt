import"../../CommonImports";import"../../Core/core.css";import"./Table.css";import*as React from"react";import{ObservableValue}from"../../Core/Observable";import{announce}from"../../Core/Util/Accessibility";import{Checkbox,TriStateCheckbox}from"../../Checkbox";import{Observer}from"../../Observer";import*as Resources from"../../Resources.Widgets";import{css,KeyCode,preventDefault}from"../../Util";import{IMeasurementStyle,TableColumnLayout}from"./Table.Props";var ColumnSelect=function(){function e(e){var n=this;this.columnSelectBehavior={initialize:function(e){n.ariaHidden="menu"===e.tableProps.role,n.itemProvider=e.tableProps.itemProvider,n.selection=e.tableProps.selection,n.onSelect=e.tableProps.onSelect},componentDidMount:function(e){n.componentDidMount(e)},componentDidUpdate:function(e){n.componentDidUpdate(e)},componentWillUnmount:function(){n.componentWillUnmount()}},this.allSelected=new ObservableValue(!1),this.columnLayout=TableColumnLayout.none,this.id="_select",this.width=2.5,this.widthStyle=IMeasurementStyle.REM,this.behaviors=[this.columnSelectBehavior],this.renderCell=function(t,e,o){var i=n.selection,l=i&&i.selected(t),i=i&&i.selectable(t);return React.createElement("td",{"aria-colindex":e+1,"aria-hidden":n.ariaHidden,className:css("bolt-table-cell-select bolt-table-cell bolt-list-cell","col-"+e),"data-column-index":e,key:"col-select",onClick:preventDefault,onDoubleClick:preventDefault,onMouseDown:function(e){n.updateSelection(e,t),e.preventDefault()},onKeyDown:function(e){e.which===KeyCode.space&&(n.updateSelection(e,t),e.preventDefault())}},React.createElement("div",{className:"flex-row justify-center"},React.createElement("span",{className:"flex-row-inline"},React.createElement(Checkbox,{role:null==(e=n.props)?void 0:e.role,ariaLabel:"presentation"===(null==(e=n.props)?void 0:e.role)?void 0:Resources.SelectRowLabel,checked:!!l,excludeFocusZone:null==(e=n.props)?void 0:e.excludeFocusZone,excludeTabStop:!0,disabled:!i}))))},this.renderHeaderCell=function(e,i,l){return React.createElement("th",{"aria-colindex":e+1,className:css("bolt-table-cell-select bolt-table-header-cell","col-header-"+e),"data-column-index":e,key:"col-select"},React.createElement("div",{className:"flex-row"},React.createElement(Observer,{allSelected:n.allSelected},function(e){var t=n.itemProvider,o=n.selection,t=t&&t.length;return o&&o.multiSelect&&-1!==t?React.createElement("div",{className:"flex-row flex-grow justify-center"},React.createElement(TriStateCheckbox,{ariaLabel:null!=(o=i.ariaLabel)?o:Resources.SelectAllRowsLabel,checked:e.allSelected,focuszoneId:l,onChange:n.onChangeHeader})):React.createElement("div",{"aria-label":null!=(t=i.ariaLabel)?t:Resources.SelectionColumnLabel})})))},this.onChangeHeader=function(e){var t=n.itemProvider,o=n.onSelect,i=n.selection;if(i&&(!1!==n.allSelected.value?(i.clear(),announce(Resources.AllRowsUnselectedMessage,!0)):(i.select(0,t&&t.length),announce(Resources.AllRowsSelectedMessage,!0))),o&&t)for(var l=0;l<t.length;l++)o(e,n.getListRow(l))},this.onSelectionChange=function(){var e,t=n.itemProvider,o=n.selection;o&&(e=o.selectedCount,t=t&&t.length-o.unselectableCount,n.allSelected.value=0<e&&(e===t||void 0))},this.updateSelection=function(e,t){var o=n.onSelect,i=n.selection;i&&(i.selected(t)?i.unselect(t):i.select(t,1,!0)),o&&o(e,n.getListRow(t))},this.getListRow=function(e){return{data:n.itemProvider?n.itemProvider.value[e]:{},index:e}},this.props=e}return e.prototype.componentDidMount=function(e){var t=this.itemProvider,o=this.selection;o&&(o.subscribe(this.onSelectionChange),this.onSelectionChange()),t&&t.subscribe&&t.subscribe(this.onSelectionChange)},e.prototype.componentDidUpdate=function(e){var t=this.selection;t!==e.tableProps.selection&&(t&&t.unsubscribe(this.onSelectionChange),t=e.tableProps.selection,this.selection=t)&&t.subscribe(this.onSelectionChange),t&&this.onSelectionChange(),this.itemProvider!==e.tableProps.itemProvider&&(this.itemProvider&&this.itemProvider.unsubscribe&&this.itemProvider.unsubscribe(this.onSelectionChange),this.itemProvider=e.tableProps.itemProvider,this.itemProvider)&&this.itemProvider.subscribe&&this.itemProvider.subscribe(this.onSelectionChange)},e.prototype.componentWillUnmount=function(){var e=this.selection;e&&e.unsubscribe(this.onSelectionChange),this.itemProvider&&this.itemProvider.unsubscribe&&this.itemProvider.unsubscribe(this.onSelectionChange)},e}();export{ColumnSelect};