import"../../CommonImports";import"../../Core/core.css";import"./List.css";import"./ListDropIndicator.css";import*as React from"react";import{getPointByEventType}from"../../Util";import{DragDropEffect}from"../../Utilities/DragDrop";import{cellFromEvent}from"./List";import{ListDropIndicator}from"./ListDropIndicator";import{ListDropIndicatorPosition}from"./ListDropIndicator.Props";var ListDropTargetBehavior=function(){function t(t){var i=this;this.initialize=function(t,o,e){i.dragDroppableUI=o,i.eventDispatch=e,i.eventDispatch.addEventListener("dragenter",i.onDragEnter),i.eventDispatch.addEventListener("dragexit",i.onDragExit),i.eventDispatch.addEventListener("dragover",i.onDragOver),i.eventDispatch.addEventListener("drop",i.onDrop),i.itemProvider=t.itemProvider,i.indicatorName=i.options.isTree?"tree-drop-indicator":"drop-indicator"},this.onDragEnter=function(t){i.handlesType(t)&&(i.options.onDragEnter?i.options.onDragEnter(t):t.detail.dataTransfer.dropEffect=DragDropEffect.move)},this.onDragExit=function(t){i.handlesType(t)&&(i.options.onDragExit&&i.options.onDragExit(t),i.dragDroppableUI.removeOverlay(i.indicatorName))},this.onDragOver=function(t){var o,e,r;i.handlesType(t)&&(o=i.calculateIndex(t),e=t.detail.dataTransfer.secondaryData.index,r=t.detail.dataTransfer.secondaryData.sourceId,0<=o&&(o!==e||r!==i.options.id||i.options.isTree)?i.options.onDragOver?i.options.onDragOver(t,{index:i.listIndicatorPosition===ListDropIndicatorPosition.bottom?o+1:o}):t.detail.dataTransfer.dropEffect=DragDropEffect.move:t.detail.dataTransfer.dropEffect=DragDropEffect.none,t.detail.dataTransfer.dropEffect===DragDropEffect.none?i.dragDroppableUI.removeOverlay(i.indicatorName):i.dragDroppableUI.addOverlay(i.indicatorName,o,i.renderDropIndicator))},this.onDrop=function(t){var o,e,r;i.handlesType(t)&&(o=i.calculateIndex(t),e=t.detail.dataTransfer.secondaryData.index,r=t.detail.dataTransfer.secondaryData.sourceId,0<=o&&(o!==e||r!==i.options.id)&&i.options.onDrop&&i.options.onDrop(t,{index:i.listIndicatorPosition===ListDropIndicatorPosition.bottom?o+1:o}),i.dragDroppableUI.removeOverlay(i.indicatorName))},this.renderDropIndicator=function(t){return i.options.isTree?React.createElement("div",{className:"bolt-list-tree-drop-target flex-grow"}):React.createElement(ListDropIndicator,{position:i.listIndicatorPosition})},this.options=t}return t.prototype.componentDidUpdate=function(t){this.itemProvider=t.itemProvider},t.prototype.componentWillUnmount=function(){var t;null!=(t=this.eventDispatch)&&t.removeEventListener("dragenter",this.onDragEnter),null!=(t=this.eventDispatch)&&t.removeEventListener("dragexit",this.onDragExit),null!=(t=this.eventDispatch)&&t.removeEventListener("dragover",this.onDragOver)},t.prototype.calculateIndex=function(t){var o,e,r=cellFromEvent(t),i=r.rowIndex;return this.options.isTree||r.rowElement&&t.detail.dataTransfer.secondaryData&&(o=t.detail.dataTransfer.secondaryData.index,e=t.detail.dataTransfer.secondaryData.sourceId,t=t.detail.nativeEvent,r=r.rowElement.getBoundingClientRect(),t=(t=getPointByEventType(t))?t.y<r.height/2+r.top:i<o,this.options.id!==e?(this.listIndicatorPosition=ListDropIndicatorPosition.top,t||i++,i>=this.itemProvider.length&&(this.listIndicatorPosition=ListDropIndicatorPosition.bottom,i--)):i<o?(this.listIndicatorPosition=ListDropIndicatorPosition.top,t||i++):o<i&&(this.listIndicatorPosition=ListDropIndicatorPosition.bottom,t)&&i--),i},t.prototype.handlesType=function(t){t=(null==(t=t.detail.dataTransfer)?void 0:t.type)||"";return-1!==this.options.allowedTypes.indexOf(t)},t}();export{ListDropTargetBehavior};