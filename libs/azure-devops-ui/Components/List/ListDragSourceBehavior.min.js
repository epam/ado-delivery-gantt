import"../../CommonImports";import"../../Core/core.css";import"./List.css";import"./ListDropIndicator.css";import*as React from"react";import{beginDragOperation,DragDropEffect,DragImage}from"../../Utilities/DragDrop";import{cellFromEvent}from"./List";var ListDragSourceBehavior=function(){function t(t){var g=this;this.initialize=function(t,e,r){g.dragDroppableUI=e,g.eventDispatch=r,g.eventDispatch.addEventListener("pointerdown",g.onPointerDown),g.eventDispatch.addEventListener("dragstart",g.onDragStart),g.eventDispatch.addEventListener("dragend",g.onDragEnd),g.eventDispatch.addEventListener("dragover",g.onDragging),g.itemProvider=t.itemProvider},this.onDragging=function(t){g.options.onDragging?g.options.onDragging(t):g.onDraggingDefault()},this.onDraggingDefault=function(){var t,e,r,o,n,a,i=null==(i=null==(i=g.dragDroppableUI)?void 0:i.currentElement)?void 0:i.current;i&&(o=(t=i.getBoundingClientRect()).top,t=t.bottom,e=.05*i.offsetHeight,r=null==(r=null==(r=g.operation)?void 0:r.y)?void 0:r.value)&&(o=r<o+e,n=0<i.scrollTop,a=i.scrollTop+i.offsetHeight<i.scrollHeight,t-e<r&&a?i.scrollTo({top:i.scrollTop+20}):o&&n&&i.scrollTo({top:i.scrollTop-20}))},this.onDragEnd=function(t){0<=cellFromEvent(t).rowIndex&&g.options.onDragEnd&&g.options.onDragEnd(t),g.dragDroppableUI.removeOverlay("drag-source-item"),g.dragImageData=void 0},this.onDragStart=function(t){var e;t.detail.dataTransfer?0<=(e=cellFromEvent(t).rowIndex)&&(g.options.onDragStart&&g.options.onDragStart(t),t.detail.dataTransfer.effectAllowed!==DragDropEffect.none)&&(g.dragDroppableUI.addOverlay("drag-source-item",e,g.renderDragSourceItemOverlay),void 0===g.dragImageData)&&(g.dragImageData={image:g.options.renderDragImage(t)}):(t.stopPropagation(),t.preventDefault())},this.onPointerDown=function(t){0===t.button&&g.beginDrag(t)},this.renderDragSourceItemOverlay=function(t){return React.createElement(React.Fragment,null,React.createElement("div",{className:"bolt-list-drag-source-item flex-grow"}),g.operation&&g.dragImageData&&React.createElement(DragImage,{operation:g.operation},g.dragImageData.image))},this.setDragImage=function(t,e,r){g.dragImageData={image:t,xOffset:e,yOffset:r}},this.options=t}return t.prototype.componentDidUpdate=function(t){this.itemProvider=t.itemProvider},t.prototype.componentWillUnmount=function(){var t;null!=(t=this.eventDispatch)&&t.removeEventListener("pointerdown",this.onPointerDown),null!=(t=this.eventDispatch)&&t.removeEventListener("dragstart",this.onDragStart),null!=(t=this.eventDispatch)&&t.removeEventListener("dragend",this.onDragEnd),null!=(t=this.eventDispatch)&&t.removeEventListener("dragover",this.onDragging)},t.prototype.beginDrag=function(t){var e,r=cellFromEvent(t).rowIndex;this.itemProvider&&0<=r&&(e=this.itemProvider.value[r],this.operation=beginDragOperation(t,{data:e,dropEffect:DragDropEffect.none,secondaryData:{index:r,sourceId:this.options.id},setDragImage:this.setDragImage,type:this.options.type}))},t}();export{ListDragSourceBehavior};