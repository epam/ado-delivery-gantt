import{__assign,__extends}from"tslib";import"../../CommonImports";import"../../Core/core.css";import*as React from"react";import{shimRef}from"../../Util";import{ResponsiveOrientation}from"./ResponsiveLayout.Props";var ResponsiveLayout=function(e){function t(){var p=null!==e&&e.apply(this,arguments)||this;return p.childDetails=[],p.childKeys=[],p.containerRef=React.createRef(),p.hiddenCount=0,p.layoutTimeout=0,p.updateLayout=function(){var e=p.containerRef.current;if(e&&e.children.length){var t=p.hiddenCount,i=e.getBoundingClientRect(),n=0,o=0,r=!1;p.childDetails&&e.children.length===p.childDetails.length||(p.childDetails=[],r=!0);for(var l=0;l<e.children.length;l++){var s=e.children[l].getBoundingClientRect();r?p.childDetails.push({appliedSize:0,clientRect:s}):p.childDetails[l].clientRect=s,p.props.ignoredChildren&&0<=p.props.ignoredChildren.indexOf(l)&&(o+=p.props.orientation===ResponsiveOrientation.Vertical?s.height:s.width)}n=p.props.orientation===ResponsiveOrientation.Vertical?Math.floor(p.childDetails[p.childDetails.length-1].clientRect.bottom-p.childDetails[0].clientRect.top):Math.floor(p.childDetails[p.childDetails.length-1].clientRect.right-p.childDetails[0].clientRect.left),n-=Math.floor(o);i=Math.floor(p.props.orientation===ResponsiveOrientation.Vertical?i.height:i.width);if(i<=n)for(var a=i-n;a<0&&p.hiddenCount<p.props.responsiveChildren.length;){var h=p.props.responsiveChildren[p.hiddenCount],d=p.childDetails[h],c=p.props.orientation===ResponsiveOrientation.Vertical?d.clientRect.height:d.clientRect.width;a+=c,d.hidden=!0,d.appliedSize=c,p.hiddenCount++}else if(n<i)for(a=i-n;0<p.hiddenCount;){h=p.props.responsiveChildren[p.hiddenCount-1],d=p.childDetails[h];if(p.childDetails[h].appliedSize+8>=a)break;a-=d.appliedSize,d.hidden=!1,p.hiddenCount--}t!=p.hiddenCount&&(p.layoutTimeout=window.setTimeout(function(){p.layoutTimeout=0,p.props.onLayoutChange&&p.props.onLayoutChange(p.hiddenCount),p.forceUpdate()},0))}},p}return __extends(t,e),t.prototype.render=function(){var i=this,n=[],e=React.Children.only(this.props.children),e=(this.containerRef=shimRef(e),React.cloneElement(e,__assign(__assign({},e.props),{ref:this.containerRef}),React.Children.map(e.props.children,function(e,t){return e.key||(console.warn("All children MUST have a unique key"),e.key=t),n[t]=e.key,i.childDetails&&i.childDetails[t]&&i.childDetails[t].hidden?React.createElement("div",{key:"PH"+t,className:"responsive-placeholder"}):e})));if(this.childKeys)if(this.childKeys.length!==n.length)this.resetLayout();else for(var t=0;t<n.length;t++)if(this.childKeys[t]!==n[t]){this.resetLayout();break}return this.childKeys=n,e},t.prototype.componentDidMount=function(){window.addEventListener("resize",this.updateLayout),this.updateLayout()},t.prototype.componentDidUpdate=function(){this.updateLayout()},t.prototype.componentWillUnmount=function(){this.layoutTimeout&&(window.clearTimeout(this.layoutTimeout),this.layoutTimeout=0),window.removeEventListener("resize",this.updateLayout)},t.prototype.resetLayout=function(){this.childDetails=void 0,this.hiddenCount=0},t}(React.Component);export{ResponsiveLayout};