import{__spreadArrays}from"tslib";import{ObservableArray}from"../Core/Observable";import{ListBoxItemType}from"../ListBox";var GroupedItemProvider=function(){function e(e,t,r){this.listItems=new ObservableArray,this.internalGroups=__spreadArrays(t),this.groupedItems=[[]];for(var s=0;s<this.internalGroups.length;s++)this.groupedItems.push([]);this.addItems(e);for(s=0;s<this.internalGroups.length;s++)this.internalGroups[s].loading&&this.setGroupLoading(this.internalGroups[s].id,!0,this.internalGroups[s].loadingItem);r&&this.addHeaders(1,this.groups.length),this.manageHeaders=!!r}return Object.defineProperty(e.prototype,"groups",{get:function(){return this.internalGroups},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this.listItems.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.listItems.value},enumerable:!1,configurable:!0}),e.prototype.subscribe=function(e,t){return this.listItems.subscribe(e,t)},e.prototype.unsubscribe=function(e,t){return this.listItems.unsubscribe(e,t)},e.prototype.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.addItems(e),e.length},e.prototype.pushGroups=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.addGroups.apply(this,__spreadArrays([this.internalGroups.length],e)),this.internalGroups.length},e.prototype.pop=function(){var e=this.listItems.pop();return e&&this.removeItems([e]),e},e.prototype.removeAll=function(e){e=this.listItems.removeAll(e);return this.removeItems(e,!1),e},e.prototype.splice=function(e,t){for(var r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];var i=this.listItems.splice(e,t);return this.removeItems(i,!1),this.addItems(r,!0,e),i},e.prototype.change=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var s=this.listItems.value.slice(e,t.length);return this.removeItems(s,!1),this.addItems(t,!1),(s=this.listItems).change.apply(s,__spreadArrays([e],t)),t.length},e.prototype.spliceGroups=function(e,t){for(var r=[],s=2;s<arguments.length;s++)r[s-2]=arguments[s];for(var i=0;i<t;i++){var o,n=e+i+1;this.groupedItems.length>n&&(this.removeItems(__spreadArrays(this.groupedItems[n])),this.manageHeaders&&0<(o=this.groupedItems.findIndex(function(e){return 0<e.length}))&&this.groupedItems[o][0].type===ListBoxItemType.Divider&&this.removeItems([this.groupedItems[o][0]]),this.groupedItems.splice(n,1))}var p=this.internalGroups.splice(e,t);return this.addGroups.apply(this,__spreadArrays([e],r)),p},e.prototype.setGroupLoading=function(t,e,r){var s,i,o=this.groups.findIndex(function(e){return e.id===t});o<0||(s=(i=this.groupedItems[++o]).findIndex(function(e){return e.type===ListBoxItemType.Loading}),!e&&i.length&&-1<s?this.removeItems([i[s]]):e&&-1===s&&(i=r||{id:t+"-loading",type:ListBoxItemType.Loading,groupId:t},this.addItems([i])),this.groups[o-1].loading=e)},e.prototype.addHeaders=function(e,t){void 0===t&&(t=1);for(var s=this,r=e;r<e+t;r++)!function(r){var e,t=s.groups[r-1];0<s.groupedItems[r].length&&(s.groupedItems[r].find(function(e){return e.type===ListBoxItemType.Header})||s.addItems([{id:t.id+"-header",text:t.name||t.id,type:ListBoxItemType.Header,groupId:t.id}]),s.groupedItems.some(function(e,t){return t<r&&0<e.length})&&!s.groupedItems[r].find(function(e){return e.type===ListBoxItemType.Divider})&&s.addItems([{id:t.id+"-divider",type:ListBoxItemType.Divider,groupId:t.id}]),0<(e=s.groupedItems.findIndex(function(e,t){return r<t&&0<e.length})))&&!s.groupedItems[e].find(function(e){return e.type===ListBoxItemType.Divider})&&(t=s.groups[e-1],s.addItems([{id:t.id+"-divider",type:ListBoxItemType.Divider,groupId:t.id}]))}(r)},e.prototype.addGroups=function(e){for(var t,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];(t=this.internalGroups).splice.apply(t,__spreadArrays([e,0],r));for(var i=[],o=0;o<r.length;o++){this.groupedItems.splice(e+o+1,0,[]);for(var n,p=this.groupedItems[0].length-1;0<=p;p--)this.groupedItems[0][p].groupId===r[o].id&&(n=this.groupedItems[0].splice(p,1)[0],this.listItems.splice(p,1),i.unshift(n))}this.addItems(i),this.manageHeaders&&this.addHeaders(e+1,r.length);for(o=0;o<r.length;o++)r[o].loading&&this.setGroupLoading(r[o].id,!0,r[o].loadingItem)},e.prototype.addItems=function(e,t,r){if(void 0===t&&(t=!0),void 0!==r)for(var s=e.length-1;0<=s;s--)this.addItem(e[s],r);else for(s=0;s<e.length;s++)this.addItem(e[s],r);t&&this.addToListItems()},e.prototype.addToListItems=function(){for(var e,t=[],r=0;r<this.groupedItems.length;r++)t.push.apply(t,this.groupedItems[r]);for(var s,i=0,o={},n=0;n<t.length;n++)this.listItems.value[i]===t[n]?(i++,s=void 0):void 0!==s?o[s].push(t[n]):o[s=i]=[t[n]];for(var p=Object.keys(o),r=p.length-1;0<=r;r--)(e=this.listItems).splice.apply(e,__spreadArrays([parseInt(p[r]),0],o[parseInt(p[r])]))},e.prototype.addItem=function(e,t){var r=0,s=0,i=e.groupId;void 0!==i&&(r=this.internalGroups.findIndex(function(e){return e.id===i})+1);for(var o,n=0;n<r;n++)s+=this.groupedItems[n].length;e.type===ListBoxItemType.Divider?this.groupedItems[r].unshift(e):e.type===ListBoxItemType.Header?this.groupedItems[r].length&&this.groupedItems[r][0].type===ListBoxItemType.Divider?(this.groupedItems[r].splice(1,0,e),s++):this.groupedItems[r].unshift(e):(o=this.groupedItems[r].length,void 0!==t&&s<=t&&t<=s+this.groupedItems[r].length?(o=t-s,s=t):void 0!==t&&t<s?o=0:s+=this.groupedItems[r].length,this.groupedItems[r].splice(o,0,e),0<r&&1===this.groupedItems[r].length&&this.manageHeaders&&this.addHeaders(r))},e.prototype.removeItems=function(n,p){void 0===p&&(p=!0);for(var d=this,e=0;e<n.length;e++)!function(e){var t=0,r=0,s=n[e].groupId;void 0!==s&&(t=d.internalGroups.findIndex(function(e){return e.id===s})+1);for(var i=0;i<t;i++)r+=d.groupedItems[i].length;var o=d.groupedItems[t],e=o.indexOf(n[e]);o.splice(e,1),p&&d.listItems.splice(r+e,1)}(e)},e}();export{GroupedItemProvider};