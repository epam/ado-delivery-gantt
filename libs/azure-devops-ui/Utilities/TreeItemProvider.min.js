import{__spreadArrays}from"tslib";import{ObservableArray}from"../Core/Observable";var TreeItemProvider=function(){function e(e){void 0===e&&(e=[]),this.itemMap=new Map;var t=[];this.rootItems=__spreadArrays(e),this.addItems(e,void 0,t),this.tableItems=new ObservableArray(t)}return Object.defineProperty(e.prototype,"length",{get:function(){return this.tableItems.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roots",{get:function(){return this.rootItems},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.tableItems.value},enumerable:!1,configurable:!0}),e.prototype.subscribe=function(e,t){return this.tableItems.subscribe(e,t)},e.prototype.unsubscribe=function(e,t){return this.tableItems.unsubscribe(e,t)},e.prototype.add=function(e,t,i){return this.splice(t,void 0,[{insertAfter:i,items:[e]}])},e.prototype.clear=function(){this.tableItems.splice(0,this.tableItems.length),this.rootItems.splice(0,this.rootItems.length)},e.prototype.collapse=function(e){e.expanded&&this.toggle(e)},e.prototype.expand=function(e,t){var i=this.itemMap.get(e);if(i){for(var r=[];i.underlyingItem.expanded||r.push(i),i=i.parentItem,t&&i;);for(var s=r.length-1;0<=s;s--)this.toggle(r[s].underlyingItem)}},e.prototype.remove=function(e,t){if(!t){this.indexOf(e);if(-1===(i=this.indexOf(e)))return;var i=this.tableItems.value[i];t=i.parentItem&&i.parentItem.underlyingItem}return this.splice(t,[e])},e.prototype.splice=function(e,t,i){var r,s=!1,n=-1,o=this.rootItems;if(e){if(!(r=this.itemMap.get(e)))return;n=this.indexOf(e),o=r.underlyingItem.childItems||[]}if(t=t&&t.slice(0),i)for(var l=0;l<i.length;l++){var a=!e||0<=n&&e.expanded?[]:void 0,d=i[l],p=n,h=0;if(d.insertAfter){if(-1===(h=o.indexOf(d.insertAfter)))continue;var m=this.indexOf(d.insertAfter,n+1);-1!==m&&(p=m+this.getTableChildCount(d.insertAfter))}else h--;this.addItems(d.items,r,a),o.splice.apply(o,__spreadArrays([h+1,0],d.items)),r&&!r.underlyingItem.childItems&&(r.underlyingItem.childItems=o,s=!0),a&&((m=this.tableItems).splice.apply(m,__spreadArrays([p+1,0],a)),s=!0)}if(t)for(l=0;l<t.length;l++){var f=t[l],a=!e||e.expanded?[]:void 0,h=void 0;-1!==(h=o.indexOf(f))&&(this.removeItem(f,a),o.splice(h,1),0===o.length&&e&&(delete e.childItems,s=!0),-1!==(f=this.indexOf(f,n+1))&&a)&&(this.tableItems.splice(f,a.length),s=!0)}s&&r&&-1!==n&&this.tableItems.change(n,r)},e.prototype.toggle=function(e){var t,i=this.indexOf(e);if(e.expanded=!e.expanded,0<=i&&e.childItems){for(var r=[],s=0;s<e.childItems.length;s++)this.getTableItems(e.childItems[s],r);e.expanded?(t=this.tableItems).splice.apply(t,__spreadArrays([i+1,0],r)):this.tableItems.splice(i+1,r.length)}},e.prototype.addItems=function(e,t,i){for(var r=0;r<e.length;r++){var s=e[r],n={depth:t?t.depth+1:0,parentItem:t,underlyingItem:s};this.itemMap.set(s,n),i&&i.push(n),s.childItems&&this.addItems(s.childItems,n,s.expanded?i:void 0)}},e.prototype.getTableItems=function(e,t){var i=this.itemMap.get(e);if(i&&(t.push(i),e.childItems)&&e.expanded)for(var r=0,s=e.childItems;r<s.length;r++){var n=s[r];this.getTableItems(n,t)}},e.prototype.getTableChildCount=function(e){var t=0;if(e.childItems&&e.expanded)for(var i=0;i<e.childItems.length;i++)t+=this.getTableChildCount(e.childItems[i])+1;return t},e.prototype.indexOf=function(e,t){for(var i=t=void 0===t?0:t;i<this.tableItems.length;i++)if(e===this.tableItems.value[i].underlyingItem)return i;return-1},e.prototype.removeItem=function(e,t){if(this.itemMap.delete(e),t&&t.push(e),e.childItems)for(var i=0;i<e.childItems.length;i++)this.removeItem(e.childItems[i],e.expanded?t:void 0)},e}();export{TreeItemProvider};